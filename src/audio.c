/*
 * audio.c
 *
 *  Created on: Aug 5, 2012
 *      Author: owen
 */

#include "arm_math.h"
#include "audio.h"


float32_t pitch_class[12] = {
		1.f, 1.0594630943593f, 1.1224620483094f, 1.1892071150027f, 1.2599210498949f, 1.33483985417f, 1.4142135623731f, 1.4983070768767f, 1.5874010519682f, 1.6817928305074f, 1.7817974362807f, 1.8877486253634f
};

float32_t semitone[100] = {
		1.f, 1.0005777895066f, 1.0011559128538f, 1.0017343702347f, 1.0023131618422f, 1.0028922878694f, 1.0034717485095f, 1.0040515439559f, 1.0046316744021f, 1.0052121400415f, 1.0057929410679f, 1.006374077675f, 1.0069555500567f, 1.0075373584071f, 1.0081195029203f, 1.0087019837904f, 1.0092848012119f, 1.0098679553791f, 1.0104514464868f, 1.0110352747294f, 1.0116194403019f, 1.0122039433992f, 1.0127887842161f, 1.013373962948f, 1.01395947979f, 1.0145453349375f, 1.015131528586f, 1.015718060931f, 1.0163049321682f, 1.0168921424935f, 1.0174796921027f, 1.0180675811919f, 1.0186558099573f, 1.0192443785951f, 1.0198332873016f, 1.0204225362735f, 1.0210121257072f, 1.0216020557995f, 1.0221923267472f, 1.0227829387473f, 1.0233738919968f, 1.0239651866929f, 1.0245568230328f, 1.025148801214f, 1.025741121434f, 1.0263337838904f, 1.026926788781f, 1.0275201363035f, 1.0281138266561f, 1.0287078600367f, 1.0293022366435f, 1.0298969566749f, 1.0304920203293f, 1.0310874278052f, 1.0316831793014f, 1.0322792750164f, 1.0328757151494f, 1.0334724998992f, 1.0340696294649f, 1.0346671040459f, 1.0352649238414f, 1.0358630890509f, 1.036461599874f, 1.0370604565103f, 1.0376596591597f, 1.0382592080222f, 1.0388591032977f, 1.0394593451863f, 1.0400599338885f, 1.0406608696045f, 1.0412621525348f, 1.0418637828801f, 1.0424657608411f, 1.0430680866187f, 1.0436707604137f, 1.0442737824274f, 1.0448771528609f, 1.0454808719154f, 1.0460849397925f, 1.0466893566937f, 1.0472941228206f, 1.0478992383751f, 1.0485047035589f, 1.0491105185742f, 1.0497166836231f, 1.0503231989077f, 1.0509300646305f, 1.051537280994f, 1.0521448482007f, 1.0527527664534f, 1.0533610359548f, 1.053969656908f, 1.054578629516f, 1.055187953982f, 1.0557976305092f, 1.0564076593012f, 1.0570180405614f, 1.0576287744935f, 1.0582398613012f, 1.0588513011885f
};



float32_t c_to_f(float32_t c){

	uint32_t pc = 0;
	uint32_t octave = 0;
	uint32_t frac = 0;  // fraction of semitone


	octave = ((uint32_t)c / 1200);
	pc = (uint32_t)(c / 100) % 12;
	frac = (uint32_t)c - ((octave * 1200) + (pc * 100));

	return pitch_class[pc] * BASE_FREQ * (float32_t)(1 << octave) * semitone[frac];
}


// just returns 1 for 0, 2 for 1200, etc....
float32_t c_to_f_ratio(float32_t c){

	uint32_t pc = 0;
	uint32_t octave = 0;
	uint32_t frac = 0;  // fraction of semitone


	octave = ((uint32_t)c / 1200);
	pc = (uint32_t)(c / 100) % 12;
	frac = (uint32_t)c - ((octave * 1200) + (pc * 100));

	return pitch_class[pc] * (float32_t)(1 << octave) * semitone[frac];
}

